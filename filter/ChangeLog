2000-12-12  Christopher James Lahey  <clahey@helixcode.com>

	* e-search-bar.c (esb_pack_menubar): Fixed some warnings.

2000-12-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-folder.c (button_clicked): Added a kludge, 'is_active'
	which is a static variable that holds whether or not there is an
	active shell folder dialog up or not.

	* vfolder-editor.c (rule_delete): Autoselect the rule that ends up
	in the same position (or the one above it if the list is shorter
	than the position).

2000-12-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-rule.c (get_widget): Don't highlight the title if it's
	"Untitled" because switching widget focus doesn't cause this
	selection to go away.

2000-12-06  Kjartan Maraas  <kmaraas@gnome.org>

	* filter-editor.c: Mark some strings for translation.
	
2000-12-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-element.c (filter_element_new_type_name): Added support
	for the system-flag type.

	* Makefile.am: Added filter-system-flag.[c,h].

	* filter-system-flag.[c,h]: New type for system flags.

	* filtertypes.xml: Oops, looks like we were still using integers
	as arguments to set-flag. Change over to using strings which are
	safer and also change the name to set-system-flag.

	* filter-driver.c (do_flag): Use strings instead of integers.
	Instead of set-flag, the callback is now set-system-flag for less
	confusion. Sorry Ettore, but you'll have to change your filters.

	* filtertypes.xml: Added system-flags stuff.

	* vfoldertypes.xml: And here too.

	* filter-message-search.c (system_flag): New ESExp callback for
	filtering on system flags.

2000-11-30  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_filter_message): Use
	camel_message_info_free() instead of freeing everything by hand -
	is this a new function? I don't ever recall seeing this
	before. Also use my new function,
	camel_message_info_new_from_header - ahhh... this code is now so
	beatiful. Okay, I'm done.

2000-11-30  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_filter_message): Update to use
	EStrv in appropriate places (wrapped with #ifdef DOESTRV for the
	moment).

2000-11-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Moved the regex filter rule around - we've
	changed the format a bit.

	* filter-option.c (option_activate): Removed.
	(get_widget): Don't connect the activate signal.

	* filter-folder.c (validate): Updated.

	* filter-datespec.c (validate): Updated.

	* filter-part.c (filter_part_validate): Updated.

	* filter-input.c (validate): Check the filter-input type - if it's
	of type "regex", then check for regex validity.

	* filter-element.c (filter_element_validate): No longer takes a
	gpointer argument.
	(filter_element_new_type_name): Allow type "regex" and create a
	new filter-input with type "regex".

2000-11-24  Michael Meeks  <michael@helixcode.com>

	* filter-message-search.c (get_full_header): impl.
	(header_full_regex): use it.

2000-11-23  Michael Meeks  <michael@helixcode.com>

	* filter-message-search.c (header_full_regex): impl.

2000-11-21  Jeffrey Stedfast  <fejj@helixcode.com>
	
	* filter-message-search.c: took out some no longer needed
	printfs.

2000-11-15  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_filter_folder): Sync here
	instead.
	(filter_driver_filter_mbox): And here too.
	(filter_driver_finalise): Don't sync here afterall - it's more
	preferable to sync right after processing.

2000-11-15  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_finalise): Sync the
	defaultfolder.
	(filter_driver_filter_folder): Sync here instead.
	(filter_driver_filter_mbox): And here too.

2000-11-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-message-search.c (header_matches): Neglect any leading
	whitespace in the header contents.
	(header_starts_with): Same.
	(header_ends_with): Same.
	(header_soundex): Same.

2000-11-12  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_filter_message): If there is a
	default folder and the message hasn't been deleted then... should
	be: If there is a default folder and the message hasn't been
	copied to another folder and the message hasn't been deleted...
	(filter_driver_filter_message): Make it so that the FILTER_LOG_END
	is only called if filtered were applied to the message so we don't
	get huge gaps of whitespace in the log file.
	(filter_driver_filter_message): 

2000-11-10  Christopher James Lahey  <clahey@helixcode.com>

	* e-search-bar.c: Made the underline show up properly in the main
	menu bar.

2000-11-10  Christopher James Lahey  <clahey@helixcode.com>

	* e-search-bar.c: Switched from using gtk_menu_item_new_with_label
	for the menu header to using gnome_stock_menu_item.

2000-11-08  Anna Marie Dirks  <anna@helixcode.com>
	* e-search-bar.c: Fixed two spacing problems: first, changed
	the spacing around the end of the text-entry widget so that 
	the text entry is always aligned with the beginning of the scrollbar;
	second, trimmed down the space between the widgets in the search bar.


2000-11-06  Not Zed  <NotZed@HelixCode.com>

	* filter-driver.c (do_flag): you shouldn't use an integer to
	set the flag.  You should use a string, and look it up, because
	the flag bits might change.
	(filter_driver_filter_message): Can som e one PLEASE STOP
	INDENTING THE CODE.  Even if i have to come over the and
	beat it into you.  YOU DONT INDENT CODE ONCE ITS BEEN CHECKED IN
	TO CVS, otherwise you SCREW UP THE DIFF's.  Can't you please
	please learn this?
	(filter_driver_log): Fixes for api changes to mime_message.

2000-11-05  Not Zed  <NotZed@HelixCode.com>

	* filter-message-search.c (get_sent_date): Fix for date change
	api.  No longer need to encode/decode the date, after its been
	encoded/ecoded already.
	(get_received_date): Likewise.

2000-11-06  Christopher James Lahey  <clahey@helixcode.com>

	* e-search-bar.h: Fixed the argument comment.  Removed an old enum
	that's not used here.

2000-11-06  Christopher James Lahey  <clahey@helixcode.com>

	* Makefile.am: Added e-search-bar.c and e-search-bar.h.

	* e-search-bar.c, e-search-bar.h: Moved this from
	e-addressbook-search.

2000-11-02  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_log): Fix for when 'desc' is
	NULL.
	(filter_driver_filter_message): Use a more user-friendly filter
	name in the log file.

2000-11-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_filter_message): Use
	filter_driver_log() where appropriate.
	(do_copy): Use the service url for the path rather than the
	folder->full_name because that'll only get you a "/mbox" which is
	entirely useless. Replace occurences of report_status with
	filter_driver_log.
	(do_move): Same.
	(report_status): Don't use this for logging anymore, use only for
	reporting the status back to the caller.
	(filter_driver_log): Renamed from filter_driver_status_log. Now
	ONLY handles file logging and is for INTERNAL USE ONLY.
	(do_flag): Replace occurences of report_status with
	filter_driver_log.
	(do_score): Same.
	(do_colour): Same.
	(do_stop): Same.

2000-11-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-datespec.c (validate): Check to make sure the user has
	entered a valid date.

2000-10-31  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Updated to allow the user to select "sounds
	like" or "does not sound like" (uses header-soundex).

	* filter-message-search.c (header_matches): Oops. Should be using
	!g_strncasecmp. This should fix it so this filter match works
	right.
	(header_starts_with): Same.
	(header_ends_with): Same.
	(header_soundex): New filter callback for soundex matching (yes,
	it's probably a bloated feature but hey, it was fun to code)

2000-10-31  Jeffrey Stedfast  <fejj@helixcode.com>
	
	* filter-folder.c (validate): Override the default validate
	function to only return TRUE if a folder has been selected.

	* filter-editor.c (rule_add): Validate that all the rule parts and
	action parts are correctly filled in.
	(rule_edit): Same.

2000-10-31  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Updated to add an action to set message flags.

	* filter-driver.c (do_flag): New callback to set message info
	flags.

	* filter-element.c (filter_element_set_data): New convenience
	function to set the data on a FilterElement.

	* filter-url.c (get_widget): Set the sources list to point to the
	FilterElement data.

2000-10-31  Federico Mena Quintero  <federico@helixcode.com>

	* filter-rule.c (get_widget): Do not pad around the Name hbox;
	its parent already has spacing.  
	Do not pad around the inframe's children; the inframe already has
	spacing.

2000-10-30  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-option.c (option_activate): If a regex option is
	selected, change the FilterElement data to TRUE else set to FALSE.

	* filter-rule.c (more_parts): Validate the previously entered
	FilterPart before allowing the user to add a new FilterPart.

	* filter-part.c (filter_part_validate): New convenience function
	to validate an entire FilterPart expression.

	* filter-input.c (validate): Validate the entry text if it
	contains a regular expression.

	* filter-element.[c,h]: New virtual function to validate the
	contents of the FilterElement (useful for regex and sexp).
	(filter_element_validate): You get the idea...	

2000-10-30  Jeffrey Stedfast  <fejj@helixcode.com>
	
	* filter-input.c: 
	* filter-option.c: 
	* filter-part.c: Pure formatting changes, no actual code
	changes. Since I know I'm going to get flamed for this, I'm sorry
	but I'll probably have to modify code in these files and it's
	easier if the code is quickly readable by me.

	* filter-rule.c (get_widget): Set the "remove" button insensitive
	for <= 1 instead of == 1.

2000-10-28  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_filter_message): Copy the message
	to the default folder if it wasn't marked as deleted.

2000-10-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Added header-starts-with, header-ends-with, and
	header-exists menu items.

	* filter-message-search.c (header_starts_with): New callback to
	match the beginnings of headers.
	(header_ends_with): New callback to match the ends of headers.
	(header_exists): New callback to determine if a header exists
	which is useful when filtering out all those pesky bug-buddy
	emails!

2000-10-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Add header-matches expressions ("is" / "is not").

	* filter-message-search.c (header_matches): New callback to match
	headers exactly (aka strcmp rather than strstr).

2000-10-27  Jacob "Ulysses" Berkman  <jacob@helixcode.com>

	* filter-driver.c (filter_driver_filter_mbox): divide before
	multiple so that we don't overflow.

2000-10-27  Christopher James Lahey  <clahey@helixcode.com>

	* Makefile.am: Fixed this to include EXTRA_GNOME_CFLAGS.

2000-10-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (do_move): Don't mark as deleted here, otherwise
	the message will have the DELETED flag set in the folder it's
	being moved to.
	(do_delete): Don't set the DELETED flag here either...we'll only
	set it at the very end of the filtering process.
	(filter_driver_filter_message): Set the DELETED flag after all
	processing is completed.

2000-10-26  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Readded Source url stuff.

	* filter-element.c (filter_element_new_type_name): Added url stuff
	back in.

	* filter-url.[c,h]: Back from the dead...

	* Makefile.am: Re-added filter-url.[c,h].

2000-10-25  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Added option menu items to allow searching
	based on regular expressions.

	* filter-message-search.c (body_regex): New callback to match text
	in the body using regex.
	(body_contains): Modified to only match using strstr.
	(header_regex): New callback to match headers using regex.
	(header_contains): Modified to only match using strstr.

2000-10-24  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Take out the reference to "Source".

	* filter-element.c (filter_element_new_type_name): Remove
	filter-url code.

	* filter-url.[c,h]: What was I smoking? There's no good reason to
	filter on source urls as there are other ways to get the same
	effect. Thanks to both Zucchi and Miguel for helping me see this
	:-)

2000-10-24  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c: Fixed NULL in fprintf.

2000-10-24  Dan Winship  <danw@helixcode.com>

	* Makefile.am (libfilter-i18n.h): Build a fake header file with
	the titles from the xml files, for translation purposes.

	* filter-rule.c (get_rule_part_widget): Call _() on the rule's
	title.

	* filter-option.c (get_widget): Call _() on the option's title.

	* filter.glade: Turn on translatable strings.

	* libfilter-i18n.h, filter.glade.h: Translatable string files.

	* add #include <config.h> to a bunch of C files so that _()
	actually does anything. Undo some UTF8 frobs since we're now
	dealing in localized strings.

2000-10-23  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-filter.c (less_parts): Set the remove button insensitive
	if there is only 1 action left.
	(more_parts): Set the remove button sensitive (since we now have 2
	or more actions).
	(get_widget): If there is only 1 action, disable the remove
	button.

	* filter-rule.c (xml_encode): If there is a defined source, don't
	set it to "incoming", set it to whatever the source is!
	(less_parts): Set the remove button insensitive if there is only 1
	criterion left.
	(more_parts): Set the remove button sensitive (since we now have 2
	or more criterion).
	(get_widget): If there is no name for the filter then set it to
	"Untitled", highlight it, and grab the focus. If there is only 1
	criterion, disable the remove button.

	* filter-editor.c, vfolder-editor.c: GUI fixes here and there as
	well as some consistancy fixes between them.

	* filter-driver.c (filter_driver_filter_mbox): Updated to send the
	source url to filter_driver_filter_message()
	(filter_driver_filter_folder): Updated to send the source url of
	the folder to filter_driver_filter_message()
	(filter_driver_filter_message): Now takes a source_url argument
	that represents the url of the folder the message is coming from
	(so that we may filter based upon that information).

2000-10-23  Christopher James Lahey  <clahey@helixcode.com>

	* filter.glade: Fixed these widgets to resize properly.

2000-10-23  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-editor.c: Remove the "demand" source from the list.

	* filter.glade: Remove the "On Demand" option and replace it with
	an "Outgoing" option.

2000-10-23  Christopher James Lahey  <clahey@helixcode.com>

	* filter-editor.c, filter-filter.c, filter-folder.c,
	filter-part.c, filter-rule.c, rule-context.c, score-editor.c,
	vfolder-editor.c: Fixed these widgets to resize properly.

2000-10-20  Jeffrey Stedfast  <fejj@helixcode.com>

	* Makefile.am: Added filter-url.[c,h].

	* filter-message-search.c (get_source): New callback to get the
	source url of the message being filtered.
	(filter_message_search): Now takes a source argument.

	* filter-element.c (filter_element_new_type_name): Added code to
	handle URL types.

	* filter-url.[c,h]: New filter object to handle URLs (ie in the
	case of filtering on source url). FIXME: find a way to populate
	the source combo box (including mail-config.h breaks the build in
	the addressbook - how does including mail-tools.h not break the
	build???)

	* filtertypes.xml: Added the source filter type and added the
	move-to action.

	* filter-driver.c (do_move): New callback, a "Copy" action should
	just copy the message to another location while a Move should both
	copy the message to a new location and delete it from the source
	location.
	(do_delete): Set the deleted flag on the message info.
	(filter_driver_filter_message): Now returns void as we don't care
	if it was copied or not in the caller functions. Also check the
	CamelMessageInfo being passed in - if the message has been marked
	as deleted prior to being filtered, then return immediately as we
	don't want to apply filter actions to deleted messages.

2000-10-19  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_filter_folder): Start fetching at
	1, not 0.

2000-10-11  Not Zed  <NotZed@HelixCode.com>

	* filter-driver.c (filter_driver_filter_mbox): Report the
	percentage of file complete for the filter.

2000-10-10  Not Zed  <NotZed@HelixCode.com>

	* filter-driver.c (filter_driver_run): Why on earth does this code
	ref all these objects for?  This is not right at all.
	(filter_driver_run): Changed source type to a string.
	(filter_driver_run): REmove the very weird exception copying
	stuff - just ref it instead.
	(do_score): 
	(do_colour): 
	(do_stop): 
	(do_copy): 
	(mark_forward): 
	(do_delete): Removed bogus 'terminated' testing.  This is NOT
	NEEDED HERE.  It is tested after every rule/action, and
	termination only makes sense at that point.
	(filter_driver_filter_message): new funciton (renamed), filter
	only a message.
	(filter_driver_filter_mbox): Filter a whole mbox.
	(filter_driver_run): If we aren't given an info, create a simple
	one based on the message headers.
	(filter_driver_filter_message): Renamed from filter_driver_run().
	(filter_driver_set_status_func): Set the status callback function.
	(filter_driver_set_default_folder): Set the default folder for
	filtering.
	(report_status): Internal function to report the status of a given
	event.
	(do_copy): Removed a pointless cache lookup - duh, we do it in
	open_folder anyway (infact, we do it in camel too!!).
	(filter_driver_filter_message): Removed pointless re-refing of
	arguments.  Why would anyone think this could be any use at all?
	(filter_driver_filter_folder): New function to filter a whole
	folder.

	* filter-editor.c (rule_add): api fixes.
	(rule_edit): 
	(rule_up): 
	(rule_down): 
	(set_sensitive): This didn't take into account the source, now it
	does.
	(select_source): Fix for api changes.  Changed the rather generic
	'number' argument to be 'source', and a string.
	(filter_editor_construct): Changed the 'number' to 'source', and
	set the string appropriately.  Added a warning for one case where
	the glade file is out of sync.

	* score-editor.c (score_editor_construct): 
	(rule_edit): 
	(rule_delete): 
	(rule_up): 
	(rule_down): 
	(set_sensitive): api fixes.

	* vfolder-editor.c (set_sensitive): Api fixes.
	(vfolder_editor_construct): 
	(rule_edit): 
	(vfolder_editor_construct): 

	* rule-context.h (RCNextRuleFunc): Added a source argument.

	* rule-context.c (rule_context_next_rule): Added source argument.
	(rule_context_find_rule): Added source argument.
	(rule_context_get_rank_rule): Added source argument.
	(rule_context_get_rank_rule_with_source): Removed.
	(save): Fixed for changes to RCNextRuleFunc prototype.

	* filter-rule.h: Changed the source to be a string, removed the
	filter_source_t type.

	* filter-rule.c (filter_rule_set_source): New function to set the
	source of a rule.  What idiot ran this code through indent?
	(filter_rule_find_list): Added a source argument.
	(filter_rule_next_list): Added a source argument.
	(get_widget): Fixed the wording.  You dont remove search parts,
	you can only remove the last one.  Why you even need to mention
	they are search 'criteria' is beyond me.  Whoever added the
	scrolled window needs to be shot, its the single most awful GUI
	feature ever invented (ranks with the close button next to
	maximise).
	(xml_encode): Save source as a string (if present).
	(xml_decode): Likewise for loading & fixed a small memleak.
	(filter_rule_finalise): Free source.

2000-10-06  Not Zed  <NotZed@HelixCode.com>

	* rule-context.c (load): Remove the stupid on-demand cb shit.
	(rule_context_load): And here too.

2000-09-27  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Now takes an argument to
	specify the log file (or NULL if logging is not to be performed).

2000-09-19  Dan Winship  <danw@helixcode.com>

	* Makefile.am (gladedir, filterdir): Use $(datadir), not
	$(prefix)/share.

2000-09-18  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Modified to use more intuitive naming

	* score-rule.c (xml_decode): Make sure the score is within our
	range
	(get_widget): Changed range to -3 to +3

	* filter-score.c (get_widget): Changed range to -3 to +3
	(xml_decode): Make sure the score is within our range

	* filter-rule.c (get_widget): Rearranged widgets.

	* filter-filter.c (get_widget): Rearranged widgets.

	* filter-editor.c (filter_editor_construct): Updated to allow for
	double-clicking on a rule to edit it.

2000-09-18  Christopher James Lahey  <clahey@helixcode.com>

	* filter-editor.c, filter-filter.c, filter-folder.c,
	filter-input.c, filter-message-search.c, filter-option.c,
	filter-rule.c, score-editor.c, vfolder-editor.c, vfolder-rule.c:
	Fixed the #include lines to deal properly with gal.

2000-09-13  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-message-search.c (body_contains): Modified to only match
	text MIME parts in the message rather than the entire MIME message
	(header_contains): Added regex matching

2000-09-12  Dan Winship  <danw@helixcode.com>

	* rule-context.c (d): 
	* filter-datespec.c (d): Turn off debugging output.

2000-09-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c: We now use a "copied" variable to record
	whether a message was marked as copied or not instead of trying to
	"guess" by looking at the folders hash table as that won't work at
	all anymore.
	(do_copy): Renamed as this is more appropriate now that it
	actually copies the message rather than marking it for copying
	later. Also fixed a logic error which prevented a message from
	being dumped into a folder if the fodler had been previously
	opened.

2000-09-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): No longer takes a
	self_destruct argument.

2000-09-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Don't freeze/thaw the
	default inbox here, let the caller freeze/thaw it. Don't destroy
	the folders hash table here, it's faster if we wait till the
	filter-driver is destroyed.
	(filter_driver_finalise): Destroy the folders hash table here
	(filter_driver_init): Initialize the folders hash table here

2000-09-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Changed "Header" to be "Message header" so it's
	not quite as confusing (??)

2000-09-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Updated to allow the user to specify arbitrary
	headers.

2000-09-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Fixed a logic error. Only
	mark filtered as TRUE if it was successfully copied to another
	folder, this means don't mark true if the default inbox is NULL.

2000-09-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Erm, okay I misunderstood
	what camel_folder_[un]hook_event() did - we don't even need this
	crap in the filter driver so lets take it completely out and let
	the caller handle this junk.

2000-09-09  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Updated to not emit the
	folder_changed signal when a message is appended to the default
	mailbox - lets leave that up to the caller so we don't queue up a
	bunch of these emits if the caller is downloading messages for
	example.

2000-09-08  Jeffrey Stedfast  <fejj@helixcode.com>

	* filtertypes.xml: Added scoring xml stuffs
	
	* Makefile.am: added filter-score.[c,h]
	
	* filter-score.[c,h]: New functions to handle the "score" filter
	type.
	
	* filter-element.c (filter_element_new_type_name): Added support
	for "score" type.
	
	* filter-driver.c (do_score): New ESExp callback for filter
	actions to set the score on a message.
	
	* filter-message-search.c (get_score): New ESExp callback for
	getting the score tag as an integer value.

2000-09-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Now takes a
	CamelMessageInfo argument in preparation for handling scoring

2000-09-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Modified to return a
	boolean value specifying whether or not the message was filtered
	into a folder other than the default. The default mailbox can now
	also be specified as NULL if the message shouldn't be appended to
	it in the case that it's not filtered into some other folder.

2000-09-07  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Rewrote - this shouldn't
	need to be an async function

	* filter-message-search.c (match_all): Modified to look at the
	boolean value being fed to it and just to return that instead of
	always returning TRUE

2000-09-07  Lauris Kaplinski  <lauris@helixcode.com>

	* filter-editor.c, filter-filter.c, filter-folder.c, filter-option.c:
	* filter-rule.c, score-editor.c, vfolder-editor.c, vfolder-rule.c:
	More UTF-8 wrapping

2000-09-06  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Totally rewritten to filter
	a single message at a time instead of filtering a folder.

	* filter-message-search.c (filter_message_search): New convenience
	function for searching a message.

2000-08-24  Lauris Kaplinski  <lauris@helixcode.com>

	* filter-folder.c: Use e_utf8 wrappers

	* filter-input.c: Use e_utf8 wrappers

	* filter-rule.c: Use e_utf8 wrappers
	
2000-08-23  Dan Winship  <danw@helixcode.com>

	* filter-datespec.c (cal_day_selected): Set seltime.tm_isdst to
	-1, not daylight, because the current dst value is not relevant to
	the selected date.

2000-08-18  Peter Williams  <peterw@helixcode.com>

	* filter-driver.c (do_filter_mail): Unlink a new parameter, path_to_unlink,
	if it is empty once the mail is filtered. Fixes a race in 
	mail_tool_filter_contents_into.

	* filter-driver.h: Update the prototype.

2000-08-14  Ettore Perazzoli  <ettore@helixcode.com>

	* vfolder-editor.c (rule_add): Add translation marks and use stock
	buttons.
	(rule_edit): Likewise.

	* score-editor.c (rule_add): Add translation marks and use stock
	buttons.
	(rule_edit): Likewise.

	* rule-context.c (rule_context_add_rule_gui): Add translation
	marks and use stock buttons.

	* filter-part.c (main): Add translation marks and use
	stock buttons.

	* filter-folder.c (button_clicked): Add translation marks and use
	stock buttons.

	* filter-editor.c (rule_add): Add translation marks and use stock
	buttons.
	(rule_edit): Likewise.

	* filter-rule.c (get_widget): Add translation marks.

	* filter-filter.c (get_widget): Add translation marks.  Add
	padding to make it look like the buttons in `filter-rule.c'.

2000-08-17  Peter Williams  <peterw@helixcode.com>

	Implement filtering on demand.

	* rule-context.h: Add a new callback to rule_context_load
	that allows the caller to hook on-demand rules into its UI.

	* rule-context.c (rule_context_load): Changed to pass the
	extra parameters to load().
	(load): If the rule is successfully loaded, call the provided
	callback so that the UI can be updated.

	* filter-editor.c (rule_add): Set the source of the new filter.
	(rule_edit): Use the new rule_context_get_rank_rule_with_source()
	so that we don't get a bad index into the GtkList.
	(rule_delete): Same as above.
	(rule_up): Same as above.
	(rule_down): Same as above.
	(select_source): New function. When the user changes the 
	dropdown list to select a new source type, repopulate the
	list with rules of the appropriate type.
	(filter_editor_construct): Code moved from here into
	select_source(). Hook up all the elements of the source optionmenu
	to callbacks to select_source().

	* filter-rule.c (xml_encode): Save the rule's source type.
	(xml_decode): Load it. Default to 'incoming' if unspecified.

	* filter-rule.h: New enumeration, _filter_source_t, the
	specifies the rule's source. Add it to struct _FilterRule.
	
	* filter-driver.c (filter_driver_run): Add a new input,
	sourcetype, that specifies which rules to run (only ones
	with the same source will be run). struct filter_mail_input_t
	changed to accomodate.
	(do_filter_mail): Skip rules if they're not the specified source.
	If source and dest are the same, don't delete the messages or
	copy unnecessarily.

	* filter.glade: Make the optionmenu sensitive. Change "Outgoing"
	to "On Demand" (outgoing should be added later).
	
2000-08-15  Peter Williams  <peterw@curious-george.helixcode.com>

	* vfoldertype.xml, filtertypes.xml: Add entries defining the
	date-based message filtering and vfoldering.

	* filter-datespec.{c,h}: New files implementing the UI for
	date-based filtering and vfoldering -- specifically, choosing
	what to compare the message to.

	* filter-element,c: Hook up to create a datespec filter if
	that's what's called for.

	* Makefile.am: Build the new -datespec files.

2000-08-13  Dan Winship  <danw@helixcode.com>

	* Makefile.am (EXTRA_DIST): remove blank.xpm and check.xpm which
	no longer exist. Add filter.glade.

2000-08-12  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (describe_filter_mail): Use
	mail_tool_get_folder_name here too. (Hm... this directory really
	shouldn't depend on stuff in mail/, but it already did. We'll have
	to sort this out later.)

2000-08-11  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (do_filter_mail): Remove an '#if 0' that must
	have been left in accidentally, so that messages which are copied
	to other folders will not also be copied into the Inbox. Also,
	#ifdef out the line that printfs the rule, because the rules are
	often very large.

2000-08-11  Not Zed  <NotZed@HelixCode.com>

	* filter-driver.c (do_colour): Use proper accessor function
	instead of poking the structure.

2000-08-10  Christopher James Lahey  <clahey@helixcode.com>

	* filter-driver.c, filter-folder.c, rule-context.c,
	vfolder-editor.c: Fixed some warnings.

2000-08-10  Peter Williams  <peterw@helixcode.com>

	* filter-driver.c (do_filter_mail): Fix the infinite fetchmail.

2000-08-10  Not Zed  <NotZed@HelixCode.com>

	* filter-driver.c (filter_driver_run): Save the results of
	searches till we're done.  So we dont have to go strduping strings
	agian and again and again and again ...  Remove all the unecessary
	strdups.
	(do_colour): Implement.
	(filter_driver_run): Change for append api change.
	(free_key): Removed.

2000-08-09  Not Zed  <NotZed@HelixCode.com>

	* rule-context.c (rule_context_add_rule_gui): Helper function to
	add a rule, but present a gui first, asking for confirmation/allow
	editing.
	(rule_context_add_rule_gui): Keep track of context so it isn't freed under us.

	* filter-context.c (filter_context_create_action): Implement,
	helper to aid filter generation.

2000-08-08  Peter Williams  <peterw@helixcode.com>

	* filter-driver.c (close_folder): Fix an accidental GTK unref
	of a CamelObject.

2000-08-03  Ettore Perazzoli  <ettore@helixcode.com>

	* filter-folder.c (button_clicked): Use the base name of the
	Evoluton URI for the button's label.
	(get_widget): Likewise.

2000-08-03  Peter Williams  <peterw@helixcode.com>

	* filter-driver.c (op_filter_mail): Conform to the new mail-threads
	interface.

2000-08-01  Not Zed  <NotZed@HelixCode.com>

	* vfolder-editor.c (rule_add): Oops, create a vfolder_rule when we
	add a new one.

	* rule-context.c (load): If there are no user rules, dont bomb
	out.

2000-07-31  Not Zed  <NotZed@HelixCode.com>

	* filter-input.c (filter_input_set_value): Set value of a simple
	type to a new string.

	* filter-option.c (filter_option_set_current): New function to set
	the current value of an option.

	* filter-rule.c (filter_rule_find_list): New function to find a
	rule in a list, by name.
	(filter_rule_set_name): Let you set the name of a rule.

	* rule-context.c (rule_context_find_rule): Find a rule by name.
	(rule_context_create_part): Helper to find and clone a part by
	name.

	* filter-folder.c (button_clicked): Fix warning.

	* filter.glade: Add new widgets for vfolder rule editor.
	
	* vfolder-context.c (vfolder_context_init): Changed to use vfolder
	rule as the rule type.

	* vfolder-rule.c: New class to encode extra information required
	for vfolder rules.

2000-07-30  Not Zed  <NotZed@HelixCode.com>

	**  Almost a total rewrite of every file, except for filter-driver
	which just had minor updates.

	The rule format has changed.

2000-07-24  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (do_delete, filter_driver_run): Update for
	CamelFolder API changes. (delete_message and get_uids don't take
	exceptions any more.)

2000-07-21  Peter Williams  <peterw@helixcode.com>

	* filter-driver.c (cleanup_filter_mail): Use the exception
	provided to us by the async manager instead of allocating
	our own; use mail_tool_camel_lock_{up,down} around camel
	operations.
	(filter_driver_run): Make it return void.

2000-07-20  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c: Update to make "async".

2000-07-11  Dan Winship  <danw@helixcode.com>

	* filter-driver.c: Update for CamelFolder API changes

2000-07-11  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c (filter_driver_run): Updated to reflect changes to
	camel_folder_append_message ()

2000-07-09  Dan Winship  <danw@helixcode.com>

	* filter-xml.[ch]: add a "string" type

	* filtertype.xml, vfoldertypes.xml: Use type="string" rather than
	"folder" for subject/body matching.

	* filter-arg-types.c: Update some strings for "text" input. Fix
	some warnings (including one that pointed out a real bug).

	* filter-arg.c, filter-druid.c, filter-format.c: fix warnings

2000-07-07  Dan Winship  <danw@helixcode.com>

	* filter-driver.c: Update for camel_folder_search_by_expression
	change (GList -> GPtrArray).

	* vfoldertypes.xml: sync this to filtertypes.xml (to/cc thing)

2000-07-05  Dan Winship  <danw@helixcode.com>

	* remove some non-error case debugging messages.

	* filtertypes.xml: Fix typos and update the "to-address" rule to
	match To or Cc.
	* vfoldertypes.xml: Fix typos.

	* filter-driver.c (do_delete, do_copy, do_stop,
	filter_driver_run): Add uids to the "processed" list only after
	succesfully doing something with them. Fixes the problem where
	copying a message to a folder that didn't exist would result in it
	disapearing.

2000-07-02  Ettore Perazzoli  <ettore@helixcode.com>

	* filter-driver.c (filter_driver_new): Don't free the ruleset nor
	the xmlDoc.  This will make us leak [I think], but at least
	filters work.

2000-07-02  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (open_folder): freeze the folder to avoid
	multiple folder_changed's
	(close_folder): and thaw it.
	
2000-07-02  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (filter_driver_new): kill
	filter_driver_set_session and filter_driver_set_rules and instead
	make filter_driver_new take the rules and a callback function it
	can use to turn URIs into folders.
	(open_folder): Use the callback function rather than calling camel
	directly: some URIs need special handling to turn them into stores
	and folders correctly, so let the mailer do that.

2000-07-01  Ettore Perazzoli  <ettore@helixcode.com>

	* filter-arg-types.c (arg_folder_edit_value): Only allow type
	"mail" when selecting a folder for the filter.

2000-07-01  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-driver.c: Updated to reflect changes made to 
	camel-folder.

2000-06-30  Peter Williams  <peterw@curious-george.helixcode.com>

	* filter-xml.c (filter_load_optionset_file): Check for failure
	when loading the filter doc.

	* filter-driver.c (filter_driver_set_rules): Ditto.

	* filter-editor.c (filter_editor_set_rule_files): Ditto.

2000-06-29  Ettore Perazzoli  <ettore@helixcode.com>

	* filter-arg-types.c: Replaced `global_shell_interface' with
	`global_shell_client'.
	(arg_folder_edit_value): Use
	`evolution_shell_client_user_select_folder()'.
	(create_listener): Removed.
	(impl_FolderSelectionListener_selected): Removed, together with
	all the ::Listener stuff.

2000-06-29  Arik Devens  <arik@helixcode.com>

	* vfoldertypes.xml (ruleset type="match"): Changed Cc to CC to be
	the same as the other CC rule. None of this works however, cause
	the CC code is not hooked up to camel... oh well ;-(
	
2000-06-29  Arik Devens  <arik@helixcode.com>
	
	* vfoldertypes.xml (ruleset type="match"): Added a Cc rule to
	vfolders. Works like To except on the Cc of a message ;-)
	
2000-06-28  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-arg-types.c (arg_string_edit_value): Changed "Filter name"
	to "Option value" as "Filter name" made no sense in the dialog
	(arg_address_edit_value): Same
	(arg_folder_edit_value): What do we want to return??

2000-06-27  Ettore Perazzoli  <ettore@helixcode.com>

	* filter-xml.c (load_desc): Strdup content before assigning the
	value.  Also, no need to check for NULL when g_strdup()ing as
	g_strdup() returns NULL for a NULL arg.

2000-06-27  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am (INCLUDES): `-I$(top_builddir)/shell' so that it
	works with builddir != srcdir.  [We need to #include
	"Evolution.h".]

2000-06-27  Michael Zucchi  <zucchi@zedzone.mmc.com.au>

	* Makefile.am (INCLUDES): Add the shell dir for includes (for
	corba interfaces).

	* filter-arg-types.c (impl_FolderSelectionListener_selected):
	Listener for folder query.  Sigh.
	(create_listener): Create the listener object for the folder
	dialogue query.  Uses a global for linkage to the shell object,
	via the mail component.
	(arg_folder_edit_value): Call the folder selection dialogue to
	edit the value, rather than a simple text widget.

2000-06-26  Jeffrey Stedfast  <fejj@helixcode.com>

	* filter-editor.c: Added a #include <gnome-xml/parser.h> as this
	was needed (since we used the xml parser...)
	(druid_dialogue_clicked): Do we want to use struct filter_option
	or do we instead want to use struct filter_optionrule as we had before?
	Since the function we pass the data to expects filter_option, I suspect 
	that that is what we want.

	* filter-format.h (filter_description_html_write): Renamed from
	description_html_write in order to match function name in
	filter-format.c

	* filter-druid.c (option_name_changed): Fixed a memory leak (Free'd
	a filter description list).

	* filter-arg-types.c (arg_folder_edit_values): Free'd GList data in
	argin->values.

	* filter-driver.c (filter_driver_set_rules): Added code to free an
	xmlDoc and some other data.

	* filter-arg.h: Add prototypes for filter_arg_write_html() and 
	filter_arg_write_text();

	* filter-arg-types.c: Lets see if we can't get rid of some of these 
	warnings... (use some casts to make warnings go away)
	(arg_address_edit_value): Lets make sure that ad exists before looking
	at member data.

2000-06-16  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (do_delete, filter_driver_run): Update for Camel
	flag handling changes.

2000-06-15  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (open_folder, close_folder): Update for
	CamelFolder changes.

2000-06-09  Jacob Berkman  <jacob@helixcode.com>

	* filter-editor.c (add_or_edit): use stock pixmap buttons

	* filter-druid.c (build_druid): remove the border on the notebook,
	put the html widget in a scroll frame, and add some padding

2000-06-06  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (open_folder): Update for folder
	existence/creation changes.

2000-06-02  Christopher James Lahey  <clahey@helixcode.com>

	* filter-driver.c: Free the exception and the priv struct.

2000-06-01  Christopher James Lahey  <clahey@helixcode.com>

	* filter-arg-types.c (arg_address_edit_value): Search for ad in
	arg->values instead of text since it's a list of
	filter_arg_adresses.  Also, free the old value in the list.

2000-05-30  Not Zed  <NotZed@HelixCode.com>

	* filtertypes.xml: And here too.

	* vfoldertypes.xml: Add body-contains and not-body-contains
	types.

2000-05-27  Not Zed  <NotZed@HelixCode.com>

	* vfoldertypes.xml: New file - lists rules appropriate for
	vfolders (no actions, etc).

	* Makefile.am (EXTRA_DIST): Add vfoldertypes.xml

	* filter-driver.c (filter_driver_expand_option): Made public from
	expand_filter_option.
	(filter_driver_rule_count): find out how many user rules are
	defined.
	(filter_driver_rule_get): Get a user rule by index.

2000-05-21  Ettore Perazzoli  <ettore@helixcode.com>

	* filter-druid.c: Don't pass an empty URL to `gtk_html_begin()'
	anymore.

	* filter-arg-types.c: Updated for the new GtkHTML API which uses
	`GtkHTMLStream *' instead of `GtkHTMLStreamHandle'.
	* filter-arg.c: Likewise.
	* filter-arg.h: Likewise.
	* filter-druid.c: Likewise.

	* filter-format.c: Likewise.
	* filter-format.h: Likewise.

2000-05-18  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (filter_driver_run): update for
	camel_folder_get_uids change

2000-05-17  NotZed  <NotZed@HelixCode.com>

	* filter-druid.c: Fix some html formatting.

2000-05-16  NotZed  <NotZed@HelixCode.com>

	* filter-driver.c (filter_driver_run): Delete all processed
	messages.  This is probably going to slow it down a bit.
	(filter_driver_run): Close folders before destroying them *sigh*.
	(open_folder): Actually open the folder. Doh.

	* filtertypes.xml: Initial filter rules.

	* filter-xml.c (filter_write_optionset): Save the description
	also.
	(write_description): Routine to save description - only saves 1
	node of description.

	* filter-arg.c (filter_arg_edit_clicked): Dont free edata here,
	let the destroy do it(?)

	* filter-editor.c (main): Simple driver program for testing, so i
	can fix all this really broken code *sigh*

2000-05-15  NotZed  <NotZed@HelixCode.com>

	* filter-editor.c (filter_editor_set_rule_files): filename based
	interface.
	(filter_editor_save_rules): Interface to save the options to a
	filename.

	* filter-xml.[ch]: Bunch of cleanup.

	* filter-xml.c (filter_*_file): New interfaces to read/write files
	directly, rather than messing with xmldoc crap.

	* Makefile.am: Removed filter-driver test program, now just part
	of libfilter.

	* filter-driver.c: Made an object, with an api and everything, can
	apply a filter to a given mailbox.

2000-05-10  Christopher James Lahey  <clahey@helixcode.com>

	* filter-arg.h: Changed tree.h to gnome-xml/tree.h.

	* Makefile.am: Added filter-arg-types.h, filter-arg.h,
	filter-xml.h, filter-format.h, filter-druid.h, filter-editor.h.

2000-05-02  Matt Loper  <matt@helixcode.com>

	* Makefile.am: set G_LOG_DOMAIN.

2000-05-01  NotZed  <NotZed@HelixCode.com>

	* filter-driver.c (main): Fix for api.

2000-04-30  Dan Winship  <danw@helixcode.com>

	* filter-driver.c (start): Remove no-longer-necessary call to
	camel_provider_register_as_module.

2000-04-25  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am (INCLUDES): Use `$(GTKHTML_CFLAGS)'.

2000-04-20  NotZed  <NotZed@HelixCode.com>

	* filter-driver.c: Removed a bunch of crappy unrequired headers.

	* Makefile.am (filter_driver_LDADD): Added libibex back again.

2000-04-18  Dan Winship  <danw@helixcode.com>

	* filter-driver.c: remove unused camel-log.h include

2000-04-12  Matt Loper  <matt@helixcode.com>

	* filter-arg.c (filter_arg_edit_value): Return a value.

2000-03-27  NotZed  <NotZed@HelixCode.com>

	* filter-xml.c (tokenise_xmlfreeprop): Free a prop after
	tokenising it.
	(find_node_attr): Free the prop after using it.
	(load_desc): Ditto.   I use free() because xmlFree() is nowhere to
	be found.
	(filter_load_optionset): Ditto.

	* filter-arg-types.c (arg_address_values_add_xml): free() xml
	stuff, plugs a leak.
	(arg_folder_values_add_xml): Ditto.

2000-03-22  NotZed  <NotZed@HelixCode.com>

	* filter-driver.c (main): Changed to use async search api.

2000-03-04  NotZed  <NotZed@HelixCode.com>

	* filter-druid.c (html_write_options): Output 'and' bits between
	the rules.

	* filter-driver.c (main): Actually implement filtering, at least,
	from Inbox.  Copy messages to folder (in the same store only, so
	far), delete, and stop processing are implemented, and the logic
	to handle default processing.

	* filter-xml.c (load_optionvalue): Fix up a bug where we lost the
	name of the arg (ouch).
	* filter-xml.c: Wrapped printf's in debug macros.

2000-03-02  NotZed  <NotZed@HelixCode.com>

	* filter-druid.c (object_destroy): Disconnect the list signal, so
	we dont get spurious emits during destroy.
	(arg_changed): Callback to update filter arg asynchronously.
	(arg_link_clicked): Edit the value non-modally.

	* filter-arg.c (filter_arg_edit_values_1): Changed to use
	non-modal interface.

2000-03-01  Ettore Perazzoli  <ettore@helixcode.com>

	* Makefile.am: New file.

	* Makefile: Removed.  I wonder why we are using plain Makefiles
	instead of automake Makefiles at all.

2000-02-29  NotZed  <NotZed@HelixCode.com>

	* filter-driver.c (main): Remove gui code, this will be actual
	filtering code.

	* Makefile: Added filter-editor to the library.

	* filter-editor.c (main): Comment out, make it a proper library.

2000-02-28  NotZed  <NotZed@HelixCode.com>

	* filter-druid.c: Removed unused header.

	* Makefile: Removed references to filter-sexp.[ch].

	* filter-sexp.[ch]: Removed some unecessary includes.  Moved to
	e-util.  Renamed callers.

2000-02-24  NotZed  <NotZed@HelixCode.com>

	* filter-xml.c (filter_description_free): 
	(filter_load_ruleset_free): 
	(filter_load_optionset_free): Functions for memory management.

	* filter-arg.c (filter_arg_copy): Copy the values of one arg into
	another.

	* filter-editor.c: New widget, a dialogue which uses filter-druid
	to present the various editing views.
	(druid_dialogue_clicked): On finish, save the user's new filter
	definition where it came from.

	* filter-druid.c: Changed to just being a notebook with no tabs,
	rather than a full druid (no next/prev/etc buttons).
	(option_name_changed): Update the option's description as the user
	enters it in.

2000-02-22  NotZed  <NotZed@HelixCode.com>

	* filter-xml.c (filter_clone_optionrule):
	(filter_clone_optionrule_free): 
	(filter_optionrule_new_from_rule): New utility functions for
	working with the internal rule format.

	* filter-arg.[ch]: Added new callbacks for editing a single value,
	and a new editor which shows all items in a list, and allows you
	to edit them via the single-edit method.  This needs some cleanup
	for some unused/unusable virtual methods (edit_values,
	write_html?).

	* Makefile: Add the druid for build.

	* filter-druid.c: A 'druid' widget for editing a single filter
	rule.

2000-02-21  Matt Loper  <matt@helixcode.com>

	* .cvsignore: New file.

2000-02-18  NotZed  <NotZed@HelixCode.com>

	* blank/check.xpm: Added forgotten files.

	* Uh, more changes, lots, its still work in progress.

2000-02-14  NotZed  <notzed@helixcode.com>

	* Initial import.

